---
title: 深入理解计算机系统
date: 2019-01-07 16:39:00
tags:
---

##### 静态链接
* 符号解析。目标文件定义和引用符号，每个符号对应于一个函数、一个全局变量或一个静态变量。符号解析的目的是将每个符号引用正好和一个符号定义关联起来
* 重定位。编译器和汇编器生成从地址0开始的代码和数据节。链接器通过把每个符号定义与一个内存位置关联起来，从而重定位这些节，然后修改所有对这些符号的引用，使得它们指向这个内存位置。

##### 目标文件
- 可重定位目标文件
- 可执行目标文件
- 共享目标文件
编译器和汇编器生成可重定位目标文件包括共享目标文件
连接器生成可执行目标文件

##### 动态链接共享库
共享库是一个目标模块，在运行或加载时，可以加载到任意的内存地址，并和一个在内存中的程序链接起来。在`Linux`系统中通常用`.so`后缀来表示。
- 共享方式
对于一个库只有一个`.so`文件。所有引用该库的可执行目标文件共享这个`.so`文件中的代码和数据，而不是像静态库的内容那样被复制和嵌入到引用它们的可执行文件中。
在内存中，一个共享库的`.text`节的一个副本可以被不同的正在运行的进程共享。

当加载器加载和运行可执行文件`A`时，注意到其中包含一个`.interp`节，这一节包含动态连接器的路径名，动态连接器本身就是一个共享目标（Linux系统上是ld-linux.xo）。加载器不会像它通常所做地那样将控制传递给应用，而是加载和运行这个动态连接器。然后动态连接器通过执行重定位完成连接任务，最后将控制传递给应用程序。
